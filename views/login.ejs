<!DOCTYPE html>
<html>
<head>
  <title>Đăng nhập</title>
  <link rel="stylesheet" href="/css/login.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet"/>
</head>
<body>
  <!-- Pickleball logo at bottom-right corner -->
  <div class="pickleball-logo"></div>
  
  <div class="login-container">
    <!-- Back arrow button -->
    <svg class="back-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M15 18L9 12L15 6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    
    <div class="login-inner-container">
      <div class="login-banner">ĐĂNG NHẬP</div>
      <div class="login-content-area">
        <div class="login-main-header">Số điện thoại</div>
        <div class="login-main-phone-box">
          <input type="text" name="phone_number" class="login-main-phone-inner" placeholder="Nhập số điện thoại" required>
        </div>
        <div class="login-form-content">
          <div id="message-popup" class="message-popup" style="display: none;">
            <div class="message-content">
              <span id="message-text"></span>
              <button onclick="closeMessage()" class="message-close">OK</button>
            </div>
          </div>
          <form method="POST" action="/login" onsubmit="return false;">
            <div class="login-label">Mật khẩu</div>
            <input type="password" name="password" placeholder="Nhập mật khẩu" required>
          </form>
          <div class="login-register-row">
            <span class="login-register-text">Chưa có tài khoản?</span>
            <a href="/register" class="login-register-link">Đăng ký ngay</a>
          </div>
        </div>
      </div>
      <button class="login-bottom-btn" onclick="submitForm()">
        <span class="login-bottom-btn-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 25 24" fill="none">
            <path d="M3.5 11L22.5 2L13.5 21L11.5 13L3.5 11Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="login-bottom-btn-text">Đăng nhập ngay</span>
      </button>
    </div>
  </div>

  <script>
    // Ngăn form submit khi nhấn Enter
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('form');
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm();
      });
    });
    
    function showMessage(message) {
      document.getElementById('message-text').textContent = message;
      document.getElementById('message-popup').style.display = 'flex';
    }
    
    function closeMessage() {
      document.getElementById('message-popup').style.display = 'none';
    }
    
    function submitForm() {
      const phoneNumber = document.querySelector('input[name="phone_number"]').value.trim();
      const password = document.querySelector('input[name="password"]').value;
      
      if (!phoneNumber || !password) {
        showMessage('Vui lòng nhập đầy đủ thông tin!');
        return;
      }
      
      // Validate phone 10-11 số
      if (!/^\d{10,11}$/.test(phoneNumber)) {
        showMessage('Số điện thoại phải có 10-11 số!');
        return;
      }
      
      // Tạo form data và gửi bằng fetch
      const formData = new URLSearchParams();
      formData.append('phone_number', phoneNumber);
      formData.append('password', password);
      
      fetch('/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: formData
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        showMessage(data.message);
        if (data.success) {
          // Redirect to home page after a short delay
          setTimeout(() => {
            window.location.href = '/home';
          }, 1500);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showMessage('Có lỗi xảy ra!');
      });
    }
  </script>
</body>
</html> 